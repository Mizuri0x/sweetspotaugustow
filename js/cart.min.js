let cart=[];function loadCart(){try{var saved=localStorage.getItem("sweetspot_cart");if(saved){cart=JSON.parse(saved);if(!Array.isArray(cart))cart=[];}}catch(e){console.error('Dane koszyka uszkodzone, resetuje:',e);cart=[];localStorage.removeItem("sweetspot_cart");}
updateCartUI();}
function saveCart(){try{localStorage.setItem("sweetspot_cart",JSON.stringify(cart));}catch(e){console.error('Nie udalo sie zapisac koszyka:',e);}}
function addToCart(productId){const product=getProductById(productId);if(!product)return;const existingItem=cart.find(item=>String(item.id)===String(productId));if(existingItem){existingItem.quantity+=1;}else{cart.push({id:product.id,name:product.name,price:product.price,emoji:product.emoji,quantity:1});}
saveCart();updateCartUI();showAddedNotification(product.name);}
function removeFromCart(productId){cart=cart.filter(item=>String(item.id)!==String(productId));saveCart();updateCartUI();}
function updateQuantity(productId,change){const item=cart.find(item=>String(item.id)===String(productId));if(!item)return;item.quantity+=change;if(item.quantity<=0){removeFromCart(productId);}else{saveCart();updateCartUI();}}
function getCartTotal(){return cart.reduce((sum,item)=>sum+(item.price*item.quantity),0);}
function getCartCount(){return cart.reduce((sum,item)=>sum+item.quantity,0);}
function updateCartUI(){const cartItems=document.getElementById("cartItems");const cartCount=document.getElementById("cartCount");const cartTotal=document.getElementById("cartTotal");const checkoutBtn=document.getElementById("checkoutBtn");if(cartCount){cartCount.textContent=getCartCount();cartCount.style.display=getCartCount()>0?"block":"none";}
if(cartTotal){cartTotal.textContent=`${getCartTotal()}PLN`;}
if(checkoutBtn){checkoutBtn.disabled=cart.length===0;checkoutBtn.style.opacity=cart.length===0?'0.5':'1';checkoutBtn.style.pointerEvents=cart.length===0?'none':'auto';}
if(cartItems){if(cart.length===0){cartItems.innerHTML=`<div class="cart-empty"><div class="cart-empty-icon">ðŸ›’</div><p>TwÃ³j koszyk jest pusty</p><p>Dodaj coÅ› sÅ‚odkiego!</p></div>`;}else{cartItems.innerHTML=cart.map(item=>`<div class="cart-item"><div class="cart-item-image">${item.emoji}</div><div class="cart-item-details"><div class="cart-item-name">${item.name}</div>${item.flavors?`<div class="cart-item-flavors"style="font-size:0.75rem;color:#888;margin-top:2px;">Smaki:${item.flavors}</div>`:''}<div class="cart-item-price">${item.price}PLN</div><div class="cart-item-quantity"><button class="quantity-btn"onclick="updateQuantity('${item.id}', -1)"aria-label="Zmniejsz iloÅ›Ä‡">âˆ’</button><span>${item.quantity}</span><button class="quantity-btn"onclick="updateQuantity('${item.id}', 1)"aria-label="ZwiÄ™ksz iloÅ›Ä‡">+</button><button class="delete-btn"onclick="removeFromCart('${item.id}')"aria-label="UsuÅ„ z koszyka">ðŸ—‘</button></div></div></div>`).join("");}}}
function toggleCart(){const sidebar=document.getElementById("cartSidebar");const overlay=document.getElementById("cartOverlay");sidebar.classList.toggle("active");overlay.classList.toggle("active");document.body.style.overflow=sidebar.classList.contains("active")?"hidden":"";}
function showAddedNotification(productName){var el=document.getElementById('addedNotification');if(!el)return;el.textContent=(productName||'Produkt')+' dodano do koszyka!';el.classList.add('show');if(el._hideTimeout)clearTimeout(el._hideTimeout);el._hideTimeout=setTimeout(function(){el.classList.remove('show');},2500);}
const style=document.createElement("style");style.textContent=`@keyframes slideUp{from{opacity:0;transform:translateX(-50%)translateY(20px);}
to{opacity:1;transform:translateX(-50%)translateY(0);}}@keyframes fadeOut{to{opacity:0;transform:translateX(-50%)translateY(20px);}}`;document.head.appendChild(style);function clearCart(){cart=[];saveCart();updateCartUI();}
function getCartForOrder(){return{items:cart.map(item=>({name:item.name,quantity:item.quantity,price:item.price,subtotal:item.price*item.quantity})),total:getCartTotal()};}
document.addEventListener("DOMContentLoaded",loadCart);